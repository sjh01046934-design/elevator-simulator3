<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ìŠ¹ê°•ê¸° ê²€ì‚¬ê¸°ì¤€ ì‹œë®¬ë ˆì´í„°</title>

<style>
:root{
  --bg:#0b1220; --card:#111b2e; --muted:#9fb0d0; --text:#e7eefc;
  --green:#19c37d; --red:#ff4d4f; --line:#22314f;
  --shadow:0 10px 30px rgba(0,0,0,.35);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",Arial;
  background:radial-gradient(1200px 600px at 20% 0%,#14234a 0%,var(--bg) 60%);
  color:var(--text);
  font-size:14px;
}
.wrap{max-width:1200px;margin:0 auto;padding:22px 16px 70px}

/* ===== HEADER ===== */
header{
  position:sticky;top:0;z-index:5;
  background:linear-gradient(180deg, rgba(11,18,32,.98), rgba(11,18,32,.92));
  border-bottom:1px solid var(--line);
  backdrop-filter: blur(6px);
}
.header-inner{
  max-width:1200px;
  margin:0 auto;
  padding:10px 16px 12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
h1{margin:0;font-size:18px}
.sub{font-size:12px;color:var(--muted)}
.font-controls{display:flex;gap:6px}
.font-controls button{
  width:32px;height:32px;
  font-size:12px;font-weight:800;
  border-radius:8px;
  border:1px solid var(--line);
  background:rgba(22,37,69,.85);
  color:var(--text);
  cursor:pointer;
}

/* ===== PANEL ===== */
.panel{
  background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
  border:1px solid var(--line);
  border-radius:14px;
  padding:12px;
  box-shadow:var(--shadow);
  margin-top:10px;
}
.controls{
  display:grid;
  grid-template-columns:2fr 1fr;
  gap:10px;
}
@media(max-width:900px){
  .controls{display:flex;flex-direction:column}
  .controls>div:last-child{order:-1}
}

label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
input,button{
  width:100%;
  padding:10px 12px;
  border-radius:12px;
  border:1px solid var(--line);
  background:rgba(10,16,30,.55);
  color:var(--text);
}
button{cursor:pointer;font-weight:700;background:rgba(22,37,69,.85)}

.topics{
  border:1px solid var(--line);
  border-radius:12px;
  padding:8px;
  max-height:320px;
  overflow-y:auto;
}
.topic{
  display:flex;gap:8px;align-items:flex-start;
  padding:6px 4px;
  border-bottom:1px dashed rgba(255,255,255,.08)
}
.topic:last-child{border-bottom:none}
.topic input{width:auto;margin-top:2px}
.topic span{font-size:13px}

.grid{display:grid;gap:12px;margin-top:14px}
.card{
  background:rgba(17,27,46,.72);
  border:1px solid var(--line);
  border-radius:14px;
  padding:12px;
}
.title{font-weight:800;margin-bottom:6px}
.row{display:grid;grid-template-columns:140px 1fr;gap:10px}
.badge{font-size:12px;font-weight:800}
.ok{color:var(--green)}
.no{color:var(--red)}
.range{font-size:12px;color:var(--muted)}
.text{white-space:pre-wrap;line-height:1.5;font-size:13px}
mark{background:yellow;color:black}

.help-text{
  margin-top:4px;
  font-size:12px;
  color:var(--muted);
}

/* ===== ì´ë¯¸ì§€ í™•ëŒ€ ëª¨ë‹¬ ===== */
.image-modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.85);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
  cursor:zoom-out;
}
.image-modal img{
  max-width:95%;
  max-height:95%;
  border-radius:8px;
  box-shadow:0 0 30px rgba(0,0,0,0.6);
}

@media(max-width:900px){
  #titleSearch,#contentSearch,#date{
    font-size:16px;
    padding:14px;
    height:48px;
  }
}
</style>
</head>

<body>

<header>
  <div class="header-inner">
    <div>
      <h1>ìŠ¹ê°•ê¸° ê²€ì‚¬ê¸°ì¤€ ì‹œë®¬ë ˆì´í„°</h1>
      <div class="sub">ê±´ì¶•í—ˆê°€ì¼ ê¸°ë°˜ ê²€ì‚¬ê¸°ì¤€ ìë™ íŒë³„</div>
    </div>
    <div class="font-controls">
      <button id="increase-font">A+</button>
      <button id="decrease-font">Aâˆ’</button>
    </div>
  </div>
</header>

<div class="wrap">
<div class="panel">
<div class="controls">

  <!-- ê²€ì‚¬í•­ëª© -->
  <div>
    <input id="titleSearch" placeholder="ê²€ì‚¬í•­ëª©(ì œëª©) ê²€ìƒ‰">
    <input id="contentSearch" placeholder="ê¸°ì¤€ ë‚´ìš© ê²€ìƒ‰ (ì˜ˆ: 0.7 m, ì¡°ë„, í”¼ë‚œê³µê°„)" style="margin-top:6px">

    <div style="display:flex;gap:6px;margin:6px 0">
      <button id="run">ì ìš© í‘œì‹œ</button>
      <button id="reset">ì´ˆê¸°í™”</button>
    </div>

    <label>ê²€ì‚¬í•­ëª© ì„ íƒ</label>
    <div class="topics" id="topics"></div>
  </div>

  <!-- ê±´ì¶•í—ˆê°€ì¼ -->
  <div>
    <label>ê±´ì¶•í—ˆê°€ì¼</label>
    <div style="display:flex;gap:6px;margin-bottom:6px">
      <button class="preset" data-d="2013-09-15">2013.09.15 ì´í›„</button>
      <button class="preset" data-d="2019-03-28">2019.03.28 ì´í›„</button>
    </div>
    <input type="date" id="date">
    <div class="help-text">â€» ê±´ì¶•í—ˆê°€ì¼ ë‚ ì§œë¥¼ ì…ë ¥í•˜ì„¸ìš”</div>
  </div>

</div>
</div>

<div class="grid" id="results"></div>
<footer style="margin-top:10px">ğŸŸ© ì ìš© / ğŸŸ¥ ë¯¸ì ìš©</footer>
</div>

<!-- ì´ë¯¸ì§€ í™•ëŒ€ ëª¨ë‹¬ -->
<div id="imageModal" class="image-modal" onclick="closeImageModal()">
  <img id="modalImage">
</div>

<script>
let DATA=[], TITLE_MAP={}, currentFontSize=14;
const topicsEl=document.getElementById('topics');
const resultsEl=document.getElementById('results');
const dateEl=document.getElementById('date');
const titleSearch=document.getElementById('titleSearch');
const contentSearch=document.getElementById('contentSearch');
const fontTargets='body, input, button, .topic span, .title, .text, .badge, .range';

function applyFont(){
  document.querySelectorAll(fontTargets).forEach(e=>{
    e.style.fontSize=currentFontSize+'px';
  });
}

fetch('./data/criteria.json')
.then(r=>r.json())
.then(j=>{
  DATA=j.criteria||[];
  DATA.forEach(i=>{
    if(!TITLE_MAP[i.title]) TITLE_MAP[i.title]=[];
    TITLE_MAP[i.title].push(i);
  });
  renderTopics();
});

function renderTopics(){
  topicsEl.innerHTML='';
  Object.keys(TITLE_MAP).forEach(t=>{
    if(titleSearch.value && !t.includes(titleSearch.value)) return;
    const l=document.createElement('label');
    l.className='topic';
    const c=document.createElement('input');
    c.type='checkbox'; c.value=t;
    c.onchange=renderResults;
    const s=document.createElement('span');
    s.innerHTML=highlight(t,titleSearch.value);
    l.append(c,s);
    topicsEl.appendChild(l);
  });
}

function renderImage(imagePath){
  if(!imagePath) return '';
  return `
    <div style="margin-top:10px">
      <img src="${imagePath}"
           style="width:100%; max-width:400px; cursor:zoom-in; border:1px solid #22314f; border-radius:8px;"
           onclick="openImageModal('${imagePath}')">
      <div style="
        margin-top:4px;
        font-size:12px;
        color:#9fb0d0;
        text-align:center;
      ">
        â€» ì´ë¯¸ì§€ë¥¼ í¬ê²Œ ë³´ë ¤ë©´ í´ë¦­í•˜ì‹œì˜¤.
      </div>
    </div>
  `;
}

function openImageModal(src){
  const modal=document.getElementById('imageModal');
  const img=document.getElementById('modalImage');
  img.src=src;
  modal.style.display='flex';
}
function closeImageModal(){
  document.getElementById('imageModal').style.display='none';
}

function isApplied(d,f,t){
  if(!d) return false;
  const b=new Date(d);
  if(f && b<new Date(f)) return false;
  if(t && b>new Date(t)) return false;
  return true;
}

function highlight(t,k){
  if(!k) return t;
  return t.replace(new RegExp(`(${k})`,'gi'),'<mark>$1</mark>');
}

function renderResults(){
  resultsEl.innerHTML='';
  const keyword = contentSearch.value.trim().toLowerCase();
  let targets = [];

  if (keyword) {
    targets = DATA;
  } else {
    document.querySelectorAll('#topics input:checked').forEach(cb=>{
      (TITLE_MAP[cb.value]||[]).forEach(i=>targets.push(i));
    });
  }

  targets.forEach(i=>{
    const hay=(i.title+i.label+i.text).toLowerCase();
    if(keyword && !hay.includes(keyword)) return;

    const card=document.createElement('div');
    card.className='card';
    card.innerHTML=`
      <div class="title">${highlight(i.title,contentSearch.value)}</div>
      <div class="row">
        <div class="badge ${isApplied(dateEl.value,i.from,i.to)?'ok':'no'}">
          ${isApplied(dateEl.value,i.from,i.to)?'ğŸŸ© ì ìš©':'ğŸŸ¥ ë¯¸ì ìš©'}
          <div class="range">${i.from||'â€”'} ~ ${i.to||'í˜„ì¬'}</div>
        </div>
        <div class="text">
          <b>${highlight(i.label,contentSearch.value)}</b><br>
          ${highlight(i.text,contentSearch.value)}
        </div>
      </div>
      ${renderImage(i.image)}
    `;
    resultsEl.appendChild(card);
  });
}

/* ì´ë²¤íŠ¸ */
document.getElementById('increase-font').onclick=()=>{currentFontSize++;applyFont()};
document.getElementById('decrease-font').onclick=()=>{currentFontSize=Math.max(10,currentFontSize-1);applyFont()};
document.getElementById('run').onclick=renderResults;
document.getElementById('reset').onclick=()=>{
  titleSearch.value=''; contentSearch.value=''; dateEl.value='';
  document.querySelectorAll('#topics input').forEach(c=>c.checked=false);
  renderTopics(); renderResults();
};
titleSearch.oninput=renderTopics;
contentSearch.oninput=renderResults;
document.querySelectorAll('.preset').forEach(b=>{
  b.onclick=()=>{dateEl.value=b.dataset.d;renderResults();}
});
</script>

</body>
</html>

